@import "../../mixins.scss";

.cinebot-container {
	position: fixed;
	bottom: 30px;
	right: 30px;
	z-index: 1000;
	display: flex;
	flex-direction: column;
	align-items: flex-end;
	font-family: var(--font-family, "Inter", sans-serif);
	transition: transform 0.1s ease-out;

	&.dragging {
		transition: none !important;
	}

	.cinebot-toggle {
		width: 60px;
		height: 60px;
		border-radius: 50%;
		background: var(--gradient);
		color: white;
		border: none;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: grab;
		// Multi-layered shadow for a premium glow effect
		box-shadow:
			0 4px 10px rgba(0, 0, 0, 0.3),
			0 8px 32px rgba(218, 47, 104, 0.5),
			0 0 0 1px rgba(255, 255, 255, 0.1) inset;
		transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
		animation: floatToggle 3s ease-in-out infinite;

		&:hover {
			transform: scale(1.1) translateY(-5px);
			box-shadow:
				0 10px 20px rgba(0, 0, 0, 0.4),
				0 20px 50px rgba(218, 47, 104, 0.7),
				0 0 20px rgba(218, 47, 104, 0.4);
			animation-play-state: paused;
		}

		&:active {
			transform: scale(0.95);
			cursor: grabbing;
			box-shadow:
				0 2px 5px rgba(0, 0, 0, 0.5),
				0 5px 15px rgba(218, 47, 104, 0.6);
		}
	}

	.chat-window {
		width: 330px;
		height: 480px;
		background: rgba(4, 21, 45, 0.98);
		backdrop-filter: blur(25px);
		border: 1px solid rgba(255, 255, 255, 0.12);
		border-radius: 20px;
		margin-bottom: 15px;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
		transform: translateY(30px) scale(0.9) rotate(2deg);
		opacity: 0;
		visibility: hidden;
		transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
		transform-origin: bottom right;

		@include md {
			width: 330px; // Keep it compact even on md
			height: 480px;
			right: 0;
		}

		@media (max-width: 400px) {
			width: calc(100vw - 40px);
			height: 450px;
		}

		.chat-header {
			padding: 20px;
			background: rgba(255, 255, 255, 0.03);
			border-bottom: 1px solid rgba(255, 255, 255, 0.08);
			display: flex;
			align-items: center;
			justify-content: space-between;
			cursor: grab;

			&:active {
				cursor: grabbing;
			}

			.bot-info {
				display: flex;
				align-items: center;
				gap: 12px;

				.bot-avatar {
					width: 40px;
					height: 40px;
					background: var(--gradient);
					border-radius: 12px;
					display: flex;
					align-items: center;
					justify-content: center;
					font-size: 20px;
					box-shadow: 0 4px 10px rgba(218, 47, 104, 0.3);
				}

				.bot-details {
					h3 {
						margin: 0;
						font-size: 16px;
						font-weight: 700;
						color: white;
					}
					span {
						font-size: 11px;
						color: #00ff88;
						font-weight: 600;
						display: flex;
						align-items: center;
						gap: 4px;

						&::before {
							content: "";
							width: 6px;
							height: 6px;
							background: #00ff88;
							border-radius: 50%;
							display: block;
							animation: pulse 2s infinite;
						}
					}
				}
			}

			.close-btn {
				background: transparent;
				border: none;
				color: rgba(255, 255, 255, 0.5);
				cursor: pointer;
				transition: color 0.2s;

				&:hover {
					color: white;
				}
			}
		}

		.chat-messages {
			flex: 1;
			padding: 20px;
			overflow-y: auto;
			display: flex;
			flex-direction: column;
			gap: 15px;
			scroll-behavior: smooth;

			&::-webkit-scrollbar {
				width: 4px;
			}
			&::-webkit-scrollbar-track {
				background: transparent;
			}
			&::-webkit-scrollbar-thumb {
				background: rgba(255, 255, 255, 0.1);
				border-radius: 10px;
			}

			.message {
				display: flex;
				max-width: 85%;
				animation: messageReveal 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)
					forwards;
				opacity: 0;

				&.user {
					align-self: flex-end;
					transform-origin: bottom right;
					.message-bubble {
						background: var(--gradient);
						color: white;
						border-radius: 18px 18px 2px 18px;
						box-shadow: 0 4px 15px rgba(218, 47, 104, 0.2);
					}
				}

				&.assistant {
					align-self: flex-start;
					transform-origin: bottom left;
					.message-bubble {
						background: rgba(255, 255, 255, 0.08);
						color: rgba(255, 255, 255, 0.9);
						border-radius: 18px 18px 18px 2px;
						border: 1px solid rgba(255, 255, 255, 0.05);
					}
				}

				.message-bubble {
					padding: 12px 18px;
					font-size: 14px;
					line-height: 1.5;
					white-space: pre-wrap;
				}

				&.loading {
					.dot-typing {
						display: flex;
						gap: 4px;
						padding: 5px 0;

						span {
							width: 6px;
							height: 6px;
							background: rgba(255, 255, 255, 0.5);
							border-radius: 50%;
							animation: bounce 1.4s infinite ease-in-out both;

							&:nth-child(1) {
								animation-delay: -0.32s;
							}
							&:nth-child(2) {
								animation-delay: -0.16s;
							}
						}
					}
				}
			}
		}

		.chat-input-area {
			padding: 20px;
			background: rgba(255, 255, 255, 0.02);
			border-top: 1px solid rgba(255, 255, 255, 0.08);
			display: flex;
			gap: 10px;

			input {
				flex: 1;
				background: rgba(0, 0, 0, 0.2);
				border: 1px solid rgba(255, 255, 255, 0.1);
				border-radius: 12px;
				padding: 12px 15px;
				color: white;
				font-size: 14px;
				outline: none;
				transition: border-color 0.2s;

				&:focus {
					border-color: var(--pink);
				}
			}

			.send-btn {
				width: 45px;
				height: 45px;
				background: var(--gradient);
				border-radius: 12px;
				color: white;
				border: none;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				transition: transform 0.2s;

				&:hover:not(:disabled) {
					transform: scale(1.05);
				}

				&:disabled {
					opacity: 0.5;
					cursor: not-allowed;
				}
			}
		}
	}

	&.open {
		.chat-window {
			transform: translateY(0) scale(1);
			opacity: 1;
			visibility: visible;
		}
	}
}

@keyframes floatToggle {
	0%,
	100% {
		transform: translateY(0);
	}
	50% {
		transform: translateY(-10px);
	}
}

@keyframes messageReveal {
	from {
		opacity: 0;
		transform: translateY(15px) scale(0.8);
	}
	to {
		opacity: 1;
		transform: translateY(0) scale(1);
	}
}

@keyframes pulse {
	0% {
		transform: scale(1);
		box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7);
	}
	70% {
		transform: scale(1.2);
		box-shadow: 0 0 0 10px rgba(0, 255, 136, 0);
	}
	100% {
		transform: scale(1);
		box-shadow: 0 0 0 0 rgba(0, 255, 136, 0);
	}
}

@keyframes bounce {
	0%,
	80%,
	100% {
		transform: scale(0);
	}
	40% {
		transform: scale(1);
	}
}
